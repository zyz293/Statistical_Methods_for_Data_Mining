setwd('C:/Users/DaTui/Desktop/winter_quarter/IEME304/assignment/6')
data2 = read.csv('HW6_data2.csv', header = T)
data4 = read.csv('HW6_data4.csv', header = T)
data4 = data4[,1:3]

data2$Industry = as.factor(data2$Industry)
levels(data2$Industry) = c('OIL', 'DRUG', 'COMP')
data2$Industry = relevel(data2$Industry, ref='COMP')
newdata = data2[c(1:19),c(2:5)]
lm1 = lm(Ratio~., data=newdata)
summary(lm1)

data2$Industry = as.factor(data2$Industry)
levels(data2$Industry) = c('OIL', 'DRUG', 'COMP')
data2$Industry = relevel(data2$Industry, ref='DRUG')
newdata = data2[c(1:19),c(2:5)]
lm1 = lm(Ratio~., data=newdata)
summary(lm1)

lm2 = lm(Ratio~Margin+Industry+Rate+Industry:Rate, data=newdata)
summary(lm2)
anova(lm1, lm2)

lm0 = lm(Ratio~1, data=newdata)
lm3 = lm(Ratio~., data=newdata)
step(lm0, scope=list(lower=formula(lm0), upper=formula(lm3)), direction='both', trace=1)
lm4 = lm(Ratio~Industry+Rate, data=newdata)
summary(lm4)

library(leaps)
OIL=c(1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
DRUG=c(0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0)
data = data.frame(OIL,DRUG,newdata[,c(1,2,4)])
best = leaps(data[,1:4], data[,5], method='Cp', nbest=2, names=names(data)[1:4])
data.frame(size=best$size, Cp=best$Cp, best$which)
####Q4
glm1 = glm(y~., family=binomial(link='logit'), data=data4)
summary(glm1)
glm0 = glm(y~1, family=binomial(link='logit'), data=data4)
summary(glm0)
anova(glm0, glm1, test='Chisq')  # with Chisq, we can see P-value
new = data.frame(x1=71, x2=175)
predict(glm1, new, type='response')
new2 = data.frame(x1=68, x2=seq(100,200,by=2))
phat = predict(glm1, new2, type='response')
plot(new2$x2, phat, type='l', xlab='x2', ylab='predicted prob')
glm2 = glm(y~x2, family=binomial(link='logit'), data=data4)
anova(glm2, glm1, test='Chisq')
logLik(glm2)
logLik(glm1)
summary(glm1)
summary(glm2)
p_hat = predict(glm1, type='response')
plot(p_hat, jitter(data4$y, factor=.3))
plot(data4$x1[data4$y==1],data4$x2[data4$y==1],col='red',pch=15,xlab='x1',ylab='x2',ylim=c(80, 240),xlim=c(59,80))
points(data4$x1[data4$y==0], data4$x2[data4$y==0], col='black', pch=19)
abline(158.9, -0.271)
inf = influence(glm1)
round(data.frame(inf$hat, inf$coefficients), 3)
cooks.distance(glm1)
newdata1 = data4[-1,]
glm3 = glm(y~x1+x2, family=binomial(link='logit'), data=newdata1)
summary(glm3)
plot(newdata1$x1[newdata1$y==1],newdata1$x2[newdata1$y==1],col='red',pch=15,xlab='x1',ylab='x2',ylim=c(80, 240),xlim=c(59,80))
points(newdata1$x1[newdata1$y==0], newdata1$x2[newdata1$y==0], col='black', pch=19)
abline(27.630, 1.696)
newdata2 = data4[-39,]
glm4 = glm(y~x1+x2, family=binomial(link='logit'), data=newdata2)
summary(glm4)
plot(newdata2$x1[newdata2$y==1],newdata2$x2[newdata2$y==1],col='red',pch=15,xlab='x1',ylab='x2',ylim=c(80, 240),xlim=c(59,80))
points(newdata2$x1[newdata2$y==0], newdata2$x2[newdata2$y==0], col='black', pch=19)
abline(235.005, -1.466)
